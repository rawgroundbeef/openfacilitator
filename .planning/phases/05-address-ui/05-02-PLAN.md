---
phase: 05-address-ui
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - apps/dashboard/src/components/rewards/remove-address-dialog.tsx
  - apps/dashboard/src/components/rewards/address-list.tsx
  - apps/dashboard/src/components/rewards/address-card.tsx
  - apps/dashboard/src/components/rewards-info-banner.tsx
autonomous: true

must_haves:
  truths:
    - "User sees confirmation dialog before address removal"
    - "Confirmation warns about last verified address if applicable"
    - "Pending-only state shows prominent verify prompt"
    - "Remove completes successfully and updates list"
  artifacts:
    - path: "apps/dashboard/src/components/rewards/remove-address-dialog.tsx"
      provides: "Confirmation dialog for address removal"
      contains: "Remove this address"
    - path: "apps/dashboard/src/components/rewards/address-list.tsx"
      provides: "Updated list with removal confirmation flow"
      contains: "removeDialogOpen"
  key_links:
    - from: "address-card.tsx"
      to: "address-list.tsx"
      via: "onRemoveClick callback"
      pattern: "onRemoveClick.*setRemoveDialog"
    - from: "remove-address-dialog.tsx"
      to: "api.deleteRewardAddress"
      via: "confirm handler"
      pattern: "deleteRewardAddress.*addressToRemove"
---

<objective>
Add remove confirmation flow and edge state handling for address management

Purpose: Deliver ADDR-06 (remove address with confirmation) and complete edge state handling per CONTEXT.md decisions. Users need a safe removal flow with proper warnings.

Output: New remove-address-dialog.tsx component, wired removal flow with confirmation, pending-only banner, and last-address warning.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-address-ui/05-CONTEXT.md

# Files from Plan 01
@apps/dashboard/src/components/rewards/address-card.tsx
@apps/dashboard/src/components/rewards/address-list.tsx

# Additional context
@apps/dashboard/src/components/rewards-info-banner.tsx
@apps/dashboard/src/lib/api.ts
@apps/dashboard/src/components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RemoveAddressDialog component</name>
  <files>apps/dashboard/src/components/rewards/remove-address-dialog.tsx</files>
  <action>
Create new RemoveAddressDialog component:

```typescript
interface RemoveAddressDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  address: {
    id: string;
    address: string;
    chain_type: 'solana' | 'evm';
    verification_status: 'pending' | 'verified';
  } | null;
  isLastVerified: boolean;
  onConfirm: () => void;
  isRemoving: boolean;
}
```

Dialog content:
1. Title: "Remove Address"
2. Standard message: "Remove this address? Volume history will be preserved."
3. Show truncated address being removed
4. If isLastVerified=true, add warning: "This is your last verified address. You'll stop earning rewards until you add and verify another address."
5. Two buttons: "Cancel" (outline) and "Remove" (destructive variant)
6. Remove button shows loading state when isRemoving

Use Dialog components from ui/dialog. Style warning with yellow/amber background.
  </action>
  <verify>
`npm run build` passes. RemoveAddressDialog exports correctly and renders confirmation content.
  </verify>
  <done>
RemoveAddressDialog component exists with confirmation message, last-address warning, and loading state.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire removal confirmation flow in AddressList</name>
  <files>apps/dashboard/src/components/rewards/address-list.tsx, apps/dashboard/src/components/rewards/address-card.tsx</files>
  <action>
Update AddressList to manage removal dialog state:

1. Add state for removal dialog:
   - removeDialogOpen: boolean
   - addressToRemove: address object or null

2. Change flow:
   - AddressCard's three-dot menu "Remove" click calls onRemoveClick(address) instead of directly removing
   - AddressList receives this, sets addressToRemove and opens dialog
   - Dialog confirm calls handleRemove with addressToRemove.id
   - On success, close dialog and call onAddressRemoved

3. Calculate isLastVerified:
   - Count verified addresses in the list
   - If addressToRemove is verified AND only 1 verified address exists, isLastVerified=true

4. Update AddressCard:
   - Add onRemoveClick prop that passes the full address object
   - Three-dot menu Remove item calls onRemoveClick(address)
   - Remove the direct onRemove handling from card

Import and render RemoveAddressDialog in AddressList.
  </action>
  <verify>
`npm run build` passes. Clicking Remove in three-dot menu opens confirmation dialog. Confirming removes address and updates list.
  </verify>
  <done>
Removal flow goes through confirmation dialog. Last verified address shows warning. Dialog closes and list updates after successful removal.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add pending-only banner and edge states</name>
  <files>apps/dashboard/src/components/rewards/address-list.tsx, apps/dashboard/src/components/rewards-info-banner.tsx</files>
  <action>
Add edge state handling:

1. In AddressList, detect pending-only state:
   - If addresses exist but ALL are pending (none verified)
   - Show prominent banner/callout above the list
   - Yellow/amber background with AlertCircle icon
   - Text: "Your addresses are pending verification. Rewards won't be tracked until you verify at least one address."
   - Include "Verify Now" button that triggers enrollment modal (via new onVerifyClick prop or callback)

2. In AddressList, wire inline verify on cards:
   - Pass onVerify callback to AddressCard for pending cards
   - This opens enrollment modal to re-verify (or add new)

3. In rewards-info-banner.tsx:
   - Ensure pending-only state displays the verify prompt prominently
   - If isFacilitatorOwner but has pending addresses, show verification option

Note: The actual re-verification flow reuses the enrollment modal. User reconnects wallet and signs again for the same address. This is acceptable UX for v1.
  </action>
  <verify>
`npm run build` passes. When all addresses are pending, yellow banner appears with "Verify Now" button. Banner click opens enrollment modal.
  </verify>
  <done>
Pending-only state shows prominent verify banner. Users have clear path to verify their addresses.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` in apps/dashboard - must pass
2. Click Remove in three-dot menu - confirmation dialog opens
3. Dialog shows address being removed and warning for last verified
4. Confirm removal - address removed, list updates
5. Add multiple pending addresses - yellow banner appears with verify prompt
6. Cancel button in dialog closes without removing
</verification>

<success_criteria>
- Remove confirmation dialog appears before deletion
- Dialog shows truncated address and preserve history message
- Last verified address shows additional warning
- Removal completes and list updates correctly
- Pending-only state shows prominent verify banner
- All builds pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-address-ui/05-02-SUMMARY.md`
</output>
