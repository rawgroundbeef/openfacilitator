---
phase: 02-auth-integration
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - apps/dashboard/src/lib/api.ts
  - apps/dashboard/src/components/auth/auth-provider.tsx
  - apps/dashboard/src/components/navbar.tsx
  - apps/dashboard/src/components/rewards-info-banner.tsx
  - apps/dashboard/src/app/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Authenticated users see their admin status reflected in UI"
    - "Admin badge appears in navbar for admin users"
    - "Non-enrolled users see informational rewards banner on dashboard"
    - "Rewards banner explains the program and mentions address management is coming"
    - "AuthContext exposes isAdmin, isEnrolled, isFacilitatorOwner flags"
  artifacts:
    - path: "apps/dashboard/src/lib/api.ts"
      provides: "API client functions for rewards"
      contains: "getRewardsStatus"
    - path: "apps/dashboard/src/components/auth/auth-provider.tsx"
      provides: "Extended auth context with isAdmin"
      contains: "isAdmin"
    - path: "apps/dashboard/src/components/rewards-info-banner.tsx"
      provides: "Informational rewards banner component"
      exports: ["RewardsInfoBanner"]
  key_links:
    - from: "apps/dashboard/src/components/auth/auth-provider.tsx"
      to: "apps/dashboard/src/lib/api.ts"
      via: "fetch rewards status"
      pattern: "getRewardsStatus"
    - from: "apps/dashboard/src/components/navbar.tsx"
      to: "apps/dashboard/src/components/auth/auth-provider.tsx"
      via: "useAuth hook"
      pattern: "useAuth.*isAdmin"
    - from: "apps/dashboard/src/app/dashboard/page.tsx"
      to: "apps/dashboard/src/components/rewards-info-banner.tsx"
      via: "component import"
      pattern: "RewardsInfoBanner"
---

<objective>
Create frontend integration for auth: API client for rewards status, admin badge in navbar, and informational rewards banner for non-enrolled users.

Purpose: Allow users to see their admin status and discover the rewards program. The banner is informational-only - actual enrollment (adding verified addresses) comes in Phase 3.

Output: Extended auth context with rewards status, admin badge component, informational rewards banner component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-auth-integration/02-RESEARCH.md
@.planning/phases/02-auth-integration/02-01-SUMMARY.md

# Relevant source files
@apps/dashboard/src/lib/api.ts
@apps/dashboard/src/components/auth/auth-provider.tsx
@apps/dashboard/src/components/navbar.tsx
@apps/dashboard/src/app/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add rewards API client functions</name>
  <files>apps/dashboard/src/lib/api.ts</files>
  <action>
    Add to `apps/dashboard/src/lib/api.ts`:

    1. Define RewardsStatus type:
       ```typescript
       export interface RewardsStatus {
         isEnrolled: boolean;
         isAdmin: boolean;
         isFacilitatorOwner: boolean;
         addresses: Array<{
           id: string;
           user_id: string;
           chain_type: 'solana' | 'evm';
           address: string;
           verification_status: 'pending' | 'verified';
           verified_at: string | null;
           created_at: string;
         }>;
       }
       ```

    2. Add getRewardsStatus function:
       - GET to `${API_BASE}/api/rewards/status`
       - Include credentials: 'include' for cookies
       - Returns Promise<RewardsStatus>
       - Throws on non-OK response

    3. Add enrollInRewards function (for Phase 3 use):
       - POST to `${API_BASE}/api/rewards/enroll`
       - Body: { chain_type: 'solana' | 'evm', address: string }
       - Include credentials: 'include'
       - Returns the created address record
       - Throws on non-OK response (include 409 handling for duplicates)
       - NOTE: This function exists but won't be called until Phase 3 implements address management UI

    Follow existing patterns in api.ts for error handling and fetch configuration.
  </action>
  <verify>
    - `grep -r "getRewardsStatus" apps/dashboard/src/lib/api.ts` shows function
    - `grep -r "enrollInRewards" apps/dashboard/src/lib/api.ts` shows function
    - TypeScript compiles: `cd apps/dashboard && npx tsc --noEmit`
  </verify>
  <done>
    getRewardsStatus fetches /api/rewards/status and returns typed response.
    enrollInRewards posts to /api/rewards/enroll with address data (ready for Phase 3).
    Types match backend response shape.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend auth provider with rewards status</name>
  <files>apps/dashboard/src/components/auth/auth-provider.tsx</files>
  <action>
    Modify `apps/dashboard/src/components/auth/auth-provider.tsx`:

    1. Import getRewardsStatus from '@/lib/api'

    2. Extend AuthContextType interface:
       ```typescript
       interface AuthContextType {
         user: User | null;
         isLoading: boolean;
         isAuthenticated: boolean;
         isAdmin: boolean;           // NEW
         isEnrolled: boolean;        // NEW
         isFacilitatorOwner: boolean; // NEW
         signOut: () => Promise<void>;
         refetchRewardsStatus: () => Promise<void>; // NEW - for refresh after enrollment
       }
       ```

    3. Add state for rewards status:
       - const [rewardsStatus, setRewardsStatus] = useState<RewardsStatus | null>(null);
       - const [rewardsLoading, setRewardsLoading] = useState(false);

    4. Add useEffect to fetch rewards status when authenticated:
       - Trigger when session.user exists and is not signing out
       - Call getRewardsStatus(), update state
       - Handle errors gracefully (log, don't crash)
       - Set rewardsLoading during fetch

    5. Create refetchRewardsStatus function:
       - Re-fetches rewards status
       - For use after enrollment completes (Phase 3)

    6. Update context value:
       - isAdmin: rewardsStatus?.isAdmin ?? false
       - isEnrolled: rewardsStatus?.isEnrolled ?? false
       - isFacilitatorOwner: rewardsStatus?.isFacilitatorOwner ?? false
       - isLoading should include rewardsLoading when authenticated
       - Include refetchRewardsStatus function
  </action>
  <verify>
    - `grep -r "isAdmin" apps/dashboard/src/components/auth/auth-provider.tsx` shows property
    - `grep -r "getRewardsStatus" apps/dashboard/src/components/auth/auth-provider.tsx` shows import
    - TypeScript compiles: `cd apps/dashboard && npx tsc --noEmit`
  </verify>
  <done>
    AuthContext exposes isAdmin, isEnrolled, isFacilitatorOwner.
    Rewards status is fetched when user authenticates.
    refetchRewardsStatus allows refresh after enrollment (ready for Phase 3).
  </done>
</task>

<task type="auto">
  <name>Task 3: Add admin badge and rewards info banner</name>
  <files>
    apps/dashboard/src/components/navbar.tsx
    apps/dashboard/src/components/rewards-info-banner.tsx
    apps/dashboard/src/app/dashboard/page.tsx
  </files>
  <action>
    1. Create `apps/dashboard/src/components/rewards-info-banner.tsx`:
       - 'use client' directive
       - Import useAuth from auth-provider

       Component is INFORMATIONAL ONLY - no enrollment action:
       ```tsx
       'use client';

       import { useAuth } from '@/components/auth/auth-provider';

       export function RewardsInfoBanner() {
         const { isAuthenticated, isEnrolled, isFacilitatorOwner } = useAuth();

         // Don't show if not authenticated or already enrolled
         if (!isAuthenticated || isEnrolled) return null;

         return (
           <div className="mb-6 p-4 rounded-lg border border-primary/20 bg-primary/5">
             <div className="flex items-start justify-between">
               <div>
                 <h3 className="font-semibold text-primary">Earn $OPEN Rewards</h3>
                 <p className="text-sm text-muted-foreground mt-1">
                   {isFacilitatorOwner
                     ? "Your facilitator volume qualifies for rewards! Address management coming soon."
                     : "Track payment volume and earn $OPEN tokens. Address management coming soon."}
                 </p>
               </div>
               <span className="text-xs bg-muted px-2 py-1 rounded text-muted-foreground">Coming Soon</span>
             </div>
           </div>
         );
       }
       ```

       NOTE: This is intentionally informational. Actual enrollment requires adding
       verified Solana addresses, which is implemented in Phase 3.

    2. Add admin badge to `apps/dashboard/src/components/navbar.tsx`:
       - Get isAdmin from useAuth() (already imports useAuth)
       - After the user dropdown or in header area, show subtle badge if isAdmin
       - Use existing Badge component from '@/components/ui/badge' if available, or simple span
       - Style: small, muted, non-intrusive (e.g., "Admin" text with subtle background)

       Example placement (near WalletDropdown):
       ```tsx
       {isAuthenticated ? (
         <div className="flex items-center gap-2">
           {isAdmin && (
             <span className="text-xs px-2 py-0.5 rounded bg-muted text-muted-foreground font-medium">
               Admin
             </span>
           )}
           <WalletDropdown />
         </div>
       ) : (...)}
       ```

    3. Add banner to `apps/dashboard/src/app/dashboard/page.tsx`:
       - Import RewardsInfoBanner from '@/components/rewards-info-banner'
       - Add <RewardsInfoBanner /> near top of dashboard content (after heading, before facilitators list)
  </action>
  <verify>
    - File exists: `ls apps/dashboard/src/components/rewards-info-banner.tsx`
    - `grep -r "isAdmin" apps/dashboard/src/components/navbar.tsx` shows admin badge logic
    - `grep -r "RewardsInfoBanner" apps/dashboard/src/app/dashboard/page.tsx` shows import
    - TypeScript compiles: `cd apps/dashboard && npx tsc --noEmit`
  </verify>
  <done>
    Admin badge appears in navbar for admin users.
    Informational rewards banner appears for non-enrolled authenticated users.
    Banner explains the program and indicates address management is coming.
    Dashboard includes the rewards info banner.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes:
   ```bash
   cd apps/dashboard && npx tsc --noEmit
   ```

2. Development server starts:
   ```bash
   cd apps/dashboard && npm run dev
   # Should start without errors
   ```

3. Visual verification (manual):
   - Sign in as non-admin user -> No "Admin" badge visible
   - Sign in as admin user (add your ID to ADMIN_USER_IDS) -> "Admin" badge visible
   - Non-enrolled user sees informational rewards banner on dashboard
   - Banner shows "Coming Soon" label (no enrollment action)
</verification>

<success_criteria>
- apps/dashboard/src/lib/api.ts exports getRewardsStatus and enrollInRewards
- apps/dashboard/src/components/auth/auth-provider.tsx exposes isAdmin, isEnrolled, isFacilitatorOwner
- apps/dashboard/src/components/navbar.tsx shows Admin badge for admin users
- apps/dashboard/src/components/rewards-info-banner.tsx exists and exports RewardsInfoBanner
- apps/dashboard/src/app/dashboard/page.tsx includes RewardsInfoBanner
- Banner is informational only (no enrollment action)
- TypeScript compiles without errors on both server and dashboard
</success_criteria>

<output>
After completion, create `.planning/phases/02-auth-integration/02-02-SUMMARY.md`
</output>
